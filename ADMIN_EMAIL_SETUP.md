# ุฅุนุฏุงุฏ ูุธุงู ุฅุฏุงุฑุฉ ุงููุณุคูููู ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู

ูุฐุง ุงููุณุชูุฏ ูุดุฑุญ ููููุฉ ุฅุนุฏุงุฏ ูุงุณุชุฎุฏุงู ูุธุงู ุงูุชุญูู ุจุตูุงุญูุงุช ุงููุณุคูููู ุงููุงุฆู ุนูู ูุงุฆูุฉ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุงููุญููุธุฉ ูู Firestore.

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุตููู ูุฐุง ุงููุธุงู ูุฅุฏุงุฑุฉ ุตูุงุญูุงุช ุงููุตูู ุฅูู ููุญุฉ ุงูุฅุฏุงุฑุฉ (Admin Dashboard) ุจุงุณุชุฎุฏุงู ูุงุฆูุฉ ุจุฑูุฏ ุฅููุชุฑููู ูุญููุธุฉ ูู Firestore ุจุฏูุงู ูู Custom Claims. ูุฐุง ุงูููุฌ ูููุฑ:

- ุณูููุฉ ูู ุฅุฏุงุฑุฉ ุงููุณุคูููู ุฏูู ุงูุญุงุฌุฉ ูู Firebase Admin SDK
- ุฅููุงููุฉ ุฅุถุงูุฉ ูุญุฐู ุงููุณุคูููู ูุจุงุดุฑุฉ ูู Firebase Console ุฃู ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ
- ูุฑุงูุจุฉ ูุณุชูุฑุฉ ููุตูุงุญูุงุช ูุน ุฅููุงููุฉ ุงูุฅูุบุงุก ุงูููุฑู
- ุณุฌู ุชุฏููู ุดุงูู ูุฌููุน ุนูููุงุช ุงููุตูู

## ุงูุจููุฉ ุงูุชูููุฉ

### 1. ูุฌููุนุฉ admin_allowed_emails

ูุชู ุชุฎุฒูู ูุงุฆูุฉ ุงููุณุคูููู ูู ูุฌููุนุฉ `admin_allowed_emails` ูู Firestore ุจุงููููู ุงูุชุงูู:

```
admin_allowed_emails (collection)
  โโโ {email} (document ID = ุงูุจุฑูุฏ ุงูุฅููุชุฑููู)
      โโโ active: boolean (true/false)
      โโโ added_date: timestamp
      โโโ added_by: string (ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูููุณุคูู ุงูุฐู ุฃุถุงู ูุฐุง ุงููุณุคูู)
```

### 2. ูุฌููุนุฉ admin_access_audit_log

ูุชู ุชุณุฌูู ุฌููุน ุนูููุงุช ุงููุตูู ูู ูุฌููุนุฉ `admin_access_audit_log`:

```
admin_access_audit_log (collection)
  โโโ {logId} (auto-generated)
      โโโ email: string
      โโโ action: string (login_success, login_failed, logout, access_denied)
      โโโ details: string
      โโโ timestamp: timestamp
      โโโ user_agent: string
```

### 3. ููุงุนุฏ ุงูุฃูุงู (Security Rules)

ุชู ุชุญุฏูุซ ููุงุนุฏ Firestore ููุชุญูู ูู ูุฌูุฏ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูู ูุงุฆูุฉ admin_allowed_emails:

```javascript
function isAdmin() {
  return isAuthenticated() &&
         exists(/databases/$(database)/documents/admin_allowed_emails/$(request.auth.token.email)) &&
         get(/databases/$(database)/documents/admin_allowed_emails/$(request.auth.token.email)).data.active == true;
}
```

## ุฎุทูุงุช ุงูุฅุนุฏุงุฏ ุงูุฃููู

### ุงูุฎุทูุฉ 1: ุฅุถุงูุฉ ุฃูู ูุณุคูู ูุฏููุงู

ูุธุฑุงู ูุฃู ููุงุนุฏ ุงูุฃูุงู ุชุชุทูุจ ุฃู ูููู ุงููุณุชุฎุฏู ูุณุคููุงู ูุฅุถุงูุฉ ูุณุคูููู ุฌุฏุฏุ ูุฌุจ ุฅุถุงูุฉ ุฃูู ูุณุคูู ูุฏููุงู ูู Firebase Console:

1. ุงูุชุญ Firebase Console: https://console.firebase.google.com
2. ุงุฎุชุฑ ูุดุฑูุนู
3. ุงูุชูู ุฅูู Firestore Database
4. ุงููุฑ ุนูู "Start collection" ุฃู "Add collection"
5. ุฃุฏุฎู ุงุณู ุงููุฌููุนุฉ: `admin_allowed_emails`
6. ุฃุฏุฎู ูุนุฑู ุงููุณุชูุฏ (Document ID): ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูููุณุคูู (ูุซุงู: `admin@example.com`)
7. ุฃุถู ุงูุญููู ุงูุชุงููุฉ:
   - `active`: boolean = `true`
   - `added_date`: timestamp = (ุงุถุบุท ุนูู "Use timestamp")
   - `added_by`: string = `"system"` ุฃู `"manual"`

### ุงูุฎุทูุฉ 2: ูุดุฑ ููุงุนุฏ ุงูุฃูุงู

ุชุฃูุฏ ูู ูุดุฑ ููุงุนุฏ ุงูุฃูุงู ุงููุญุฏุซุฉ:

```bash
firebase deploy --only firestore:rules
```

ุฃู ูู Firebase Console:
1. ุงูุชูู ุฅูู Firestore Database
2. ุงุฎุชุฑ ุชุจููุจ "Rules"
3. ุงูุณุฎ ุงููุญุชูู ูู ููู `firestore.rules` ุฃู `firestore-security-rules.rules`
4. ุงููุฑ ุนูู "Publish"

### ุงูุฎุทูุฉ 3: ุชุณุฌูู ุงูุฏุฎูู ูุงุฎุชุจุงุฑ ุงููุธุงู

1. ูู ุจุฅูุดุงุก ุญุณุงุจ Firebase Authentication ุจุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุงูุฐู ุฃุถูุชู ูู ุงูุฎุทูุฉ 1
2. ุงูุชูู ุฅูู ุตูุญุฉ ููุญุฉ ุงูุฅุฏุงุฑุฉ: `/admin.html`
3. ุณุฌู ุงูุฏุฎูู ุจุงุณุชุฎุฏุงู ุงูุจุฑูุฏ ูุงููููุฉ ุงูุณุฑูุฉ
4. ูุฌุจ ุฃู ุชุชููู ูู ุงููุตูู ุฅูู ููุญุฉ ุงูุฅุฏุงุฑุฉ

## ุฅุฏุงุฑุฉ ุงููุณุคูููู

### ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ (ุงูุทุฑููุฉ ุงูููุตู ุจูุง)

ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู ุฅูู ููุญุฉ ุงูุฅุฏุงุฑุฉ:

1. ุงููุฑ ุนูู ุฃููููุฉ ุงูุฅุนุฏุงุฏุงุช (โ๏ธ) ูู ุงูุฒุงููุฉ ุงูุนูููุฉ
2. ุณุชุธูุฑ ูู ุตูุญุฉ "ุฅุฏุงุฑุฉ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูููุณุคูููู"
3. ูุฅุถุงูุฉ ูุณุคูู ุฌุฏูุฏ:
   - ุฃุฏุฎู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูู ุงูุญูู
   - ุงููุฑ ุนูู "ุฅุถุงูุฉ"
4. ูุชุนุทูู ูุณุคูู:
   - ุงููุฑ ุนูู ุฒุฑ "ุชุนุทูู" ุจุฌุงูุจ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
5. ูุญุฐู ูุณุคูู:
   - ุงููุฑ ุนูู ุฃููููุฉ ุณูุฉ ุงูููููุงุช (๐๏ธ)
   - ุชุฃูุฏ ูู ุงูุญุฐู ูู ุงููุงูุฐุฉ ุงูููุจุซูุฉ

**ููุงุญุธุฉ:** ูุง ููููู ุชุนุทูู ุฃู ุญุฐู ุจุฑูุฏู ุงูุฅููุชุฑููู ุงูุฎุงุต.

### ูู Firebase Console (ุงูุทุฑููุฉ ุงููุฏููุฉ)

1. ุงูุชุญ Firebase Console
2. ุงูุชูู ุฅูู Firestore Database
3. ุงูุชุญ ูุฌููุนุฉ `admin_allowed_emails`

**ูุฅุถุงูุฉ ูุณุคูู:**
- ุงููุฑ ุนูู "Add document"
- Document ID = ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- ุฃุถู ุงูุญููู: active, added_date, added_by

**ูุชุนุทูู ูุณุคูู:**
- ุงูุชุญ ูุณุชูุฏ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- ุบููุฑ ูููุฉ `active` ุฅูู `false`

**ูุญุฐู ูุณุคูู:**
- ุญุฏุฏ ูุณุชูุฏ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- ุงููุฑ ุนูู "Delete document"

## ุณุฌู ุงูุชุฏููู (Audit Log)

ุฌููุน ุนูููุงุช ุงููุตูู ูุงูุชุนุฏููุงุช ูุณุฌูุฉ ุชููุงุฆูุงู ูู ูุฌููุนุฉ `admin_access_audit_log`. ููููู ูุฑุงุฌุนุฉ ูุฐู ุงูุณุฌูุงุช ูู Firebase Console:

1. ุงูุชุญ Firestore Database
2. ุงูุชูู ุฅูู ูุฌููุนุฉ `admin_access_audit_log`
3. ุฑุงุฌุน ุงูุณุฌูุงุช ุญุณุจ ุงูุชุงุฑูุฎ ูุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุงูุฅุฌุฑุงุก

### ุฃููุงุน ุงูุฅุฌุฑุงุกุงุช ุงููุณุฌูุฉ:

- `login_success`: ุชุณุฌูู ุฏุฎูู ูุงุฌุญ
- `login_failed`: ูุญุงููุฉ ุชุณุฌูู ุฏุฎูู ูุงุดูุฉ
- `logout`: ุชุณุฌูู ุฎุฑูุฌ
- `access_denied`: ุฑูุถ ุงููุตูู (ุจุฑูุฏ ุฅููุชุฑููู ุบูุฑ ูุณููุญ)

## ุงูุฃูุงู ูุงูุตูุงุญูุงุช

### ููุงุนุฏ ุงูุฃูุงู ุงููุทุจูุฉ:

1. **admin_allowed_emails:**
   - ุงููุฑุงุกุฉ: ุงููุณุคูููู ููุท
   - ุงููุชุงุจุฉ: ุงููุณุคูููู ููุท
   - ุงูุญุฐู: ุงููุณุคูููู ููุท

2. **admin_access_audit_log:**
   - ุงููุฑุงุกุฉ: ุงููุณุคูููู ููุท
   - ุงูุฅูุดุงุก: ุฃู ูุณุชุฎุฏู ูุตุงุฏู (ููุชุณุฌูู ุงูุชููุงุฆู)
   - ุงูุชุญุฏูุซ ูุงูุญุฐู: ููููุน ุชูุงูุงู (ูุง ูููู ุชุนุฏูู ุณุฌู ุงูุชุฏููู)

3. **KYC Submissions ูุฌููุน ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ:**
   - ูุชู ุงูุชุญูู ูู ุตูุงุญูุงุช ุงููุณุคูู ุจุงุณุชุฎุฏุงู ุฏุงูุฉ `isAdmin()` ุงูุชู ุชูุญุต ูุงุฆูุฉ admin_allowed_emails

### ุงููุฑุงูุจุฉ ุงููุณุชูุฑุฉ:

- ูุชู ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ุจุดูู ูุณุชูุฑ (Real-time) ุฃุซูุงุก ุงูุฌูุณุฉ
- ุฅุฐุง ุชู ุชุนุทูู ุจุฑูุฏ ุฅููุชุฑููู ุฃุซูุงุก ูุฌูุฏ ุงููุณุชุฎุฏู ูู ุงููุธุงูุ ุณูุชู ุชุณุฌูู ุฎุฑูุฌู ุชููุงุฆูุงู
- ูุชู ุชุณุฌูู ุฌููุน ูุญุงููุงุช ุงููุตูู ูู ุณุฌู ุงูุชุฏููู

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ูุง ุฃุณุชุทูุน ุชุณุฌูู ุงูุฏุฎูู

**ุงูุญููู:**
1. ุชุฃูุฏ ูู ุฃู ุจุฑูุฏู ุงูุฅููุชุฑููู ููุฌูุฏ ูู ูุฌููุนุฉ `admin_allowed_emails`
2. ุชุฃูุฏ ูู ุฃู ุญูู `active` ูุณุงูู `true`
3. ุชุฃูุฏ ูู ูุดุฑ ููุงุนุฏ Firestore ุงูุฌุฏูุฏุฉ
4. ุฑุงุฌุน ุณุฌู ุงูุชุฏููู ููุนุฑูุฉ ุณุจุจ ุงูุฑูุถ

### ุงููุดููุฉ: ุชู ุชุณุฌูู ุฎุฑูุฌู ุชููุงุฆูุงู

**ุงูุฃุณุจุงุจ ุงููุญุชููุฉ:**
1. ุชู ุชุนุทูู ุจุฑูุฏู ุงูุฅููุชุฑููู ูู ูุงุฆูุฉ admin_allowed_emails
2. ุชู ุญุฐู ุจุฑูุฏู ุงูุฅููุชุฑููู ูู ุงููุงุฆูุฉ
3. ุฑุงุฌุน ุณุฌู ุงูุชุฏููู ููุนุฑูุฉ ุงูุชูุงุตูู

### ุงููุดููุฉ: ูุง ุฃุณุชุทูุน ุฅุถุงูุฉ ูุณุคูููู ุฌุฏุฏ

**ุงูุญููู:**
1. ุชุฃูุฏ ูู ุฃูู ูุณุฌู ุฏุฎูู ููุณุคูู
2. ุชุฃูุฏ ูู ุฃู ููุงุนุฏ Firestore ููุดูุฑุฉ ุจุดูู ุตุญูุญ
3. ุชุญูู ูู Console ูู ูุชุตูุญ ุงูููุจ ููุฃุฎุทุงุก

## ุฃูุถู ุงูููุงุฑุณุงุช

1. **ุงุญุชูุธ ุจูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ูุงุฆูุฉ ุงููุณุคูููู:**
   - ูู ุจุชุตุฏูุฑ ูุฌููุนุฉ admin_allowed_emails ุจุดูู ุฏูุฑู

2. **ุฑุงุฌุน ุณุฌู ุงูุชุฏููู ุจุงูุชุธุงู:**
   - ุชุญูู ูู ูุญุงููุงุช ุงููุตูู ุบูุฑ ุงููุตุฑุญ ุจูุง
   - ุฑุงูุจ ุงูุฃูุดุทุฉ ุงููุดุจููุฉ

3. **ุงุณุชุฎุฏู ูููุงุช ูุฑูุฑ ูููุฉ:**
   - ุชุฃูุฏ ูู ุฃู ุฌููุน ุญุณุงุจุงุช ุงููุณุคูููู ุชุณุชุฎุฏู ูููุงุช ูุฑูุฑ ูููุฉ
   - ูู ุจุชูุนูู ุงููุตุงุฏูุฉ ุงูุซูุงุฆูุฉ (2FA) ุนูุฏ ุงูุฅููุงู

4. **ุญุฏ ูู ุนุฏุฏ ุงููุณุคูููู:**
   - ุฃุถู ููุท ุงูุฃุดุฎุงุต ุงูุฐูู ูุญุชุงุฌูู ูุนููุงู ูููุตูู
   - ูู ุจุญุฐู ุงูุญุณุงุจุงุช ุบูุฑ ุงููุดุทุฉ

5. **ุงุณุชุฎุฏู ุจุฑูุฏ ุฅููุชุฑููู ุงุญุชุฑุงูู:**
   - ุงุณุชุฎุฏู ูุทุงู ุดุฑูุชู (ูุซุงู: admin@company.com)
   - ุชุฌูุจ ุงุณุชุฎุฏุงู ุจุฑูุฏ ุฅููุชุฑููู ุดุฎุตู

## ุงูุฏุนู

ููุญุตูู ุนูู ุงููุณุงุนุฏุฉ ุฃู ุงูุฅุจูุงุบ ุนู ูุดุงููุ ูุฑุฌู:
- ูุฑุงุฌุนุฉ Firebase Console ููุฃุฎุทุงุก
- ูุญุต ุณุฌู ุงูุชุฏููู ูุชูุงุตูู ุงููุตูู
- ุงูุชุญูู ูู ููุงุนุฏ ุงูุฃูุงู ุงูููุดูุฑุฉ

## ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ

ุงูููุฒุงุช ุงููุฎุทุท ููุง:
- [ ] ุฅุถุงูุฉ ูุณุชููุงุช ุตูุงุญูุงุช ูุชุนุฏุฏุฉ (viewer, editor, admin)
- [ ] ุฅุดุนุงุฑุงุช ุนูุฏ ุฅุถุงูุฉ ุฃู ุญุฐู ูุณุคูููู
- [ ] ูุงุฌูุฉ ูุนุฑุถ ุณุฌู ุงูุชุฏููู ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ
- [ ] ุฅููุงููุฉ ุชุตุฏูุฑ ุณุฌู ุงูุชุฏููู
- [ ] ุงูุชูุงุก ุตูุงุญูุฉ ุงููุตูู ุงูุชููุงุฆู

---

**ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ:** 2025-10-13
**ุงูุฅุตุฏุงุฑ:** 1.0.0
